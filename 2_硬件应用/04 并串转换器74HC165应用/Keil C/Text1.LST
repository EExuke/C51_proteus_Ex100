C51 COMPILER V9.02   TEXT1                                                                 04/12/2020 19:13:32 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE TEXT1
OBJECT MODULE PLACED IN Text1.OBJ
COMPILER INVOKED BY: C:\Users\99702\Documents\keil\C51\BIN\C51.EXE Text1.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //-----------------------------------------------------------------
   2          //  名称: 并串转换器74HC165应用
   3          //-----------------------------------------------------------------
   4          //  说明:切换连接到并串转换器74HC165的拨码开关,该芯片将并行数据
   5          //               以串行方式发送到单片机,显示在P0端口.
   6          //               本例给出了:(1)通过模拟时序接收
   7          //                                      (2)通过串口(RXD/TXD)接收
   8          //               两种方式的程序实现.
   9          //
  10          //-----------------------------------------------------------------
  11          #include <reg51.h>
  12          #include <intrins.h>
  13          #include <stdio.h>
  14          #define INT8U  unsigned char
  15          #define INT16U unsigned int
  16          //并串转换器相关引脚定义
  17          sbit DAT = P3^0;                        //74HC165串行数据输入引脚
  18          sbit CLK = P3^1;                        //74HC165移位时钟引脚
  19          sbit SPL = P3^2;                        //Shift/Load
  20          //-----------------------------------------------------------------
  21          // 延时函数
  22          //-----------------------------------------------------------------
  23          void delay_ms(INT16U x) 
  24          {
  25   1              INT8U t; while(x--) for(t = 0; t < 120; t++);
  26   1      }
  27          
  28          //-----------------------------------------------------------------
  29          // 模拟时序串行读取1字节(高位优先)
  30          //-----------------------------------------------------------------
  31          INT8U Serial_Input()
  32          {
  33   1              INT16U i, d = 0x00;
  34   1                      for(i = 0x80; i != 0x00; i >>= 1)       //1个字节
  35   1                      {
  36   2                              if (DAT)
  37   2                                      d |= i;                         //读取1位
  38   2                              CLK = 0; CLK = 1;               //输出时钟脉冲
  39   2                      }
  40   1                      return d;
  41   1      }
  42          
  43          //-----------------------------------------------------------------
  44          // 主程序 
  45          //-----------------------------------------------------------------
  46          void main()
  47          {  
  48   1              //通过模拟时序读取串行数据的代码
  49   1              while(1)
  50   1              { 
  51   2                      SPL = 0;                                //置数（Load），读入并行输入口的8位数据
  52   2                      SPL = 1;                                //移位（Shift），并口输入被封锁，串行转换开始
  53   2                      P0 = Serial_Input();    //串行接收1字节，显示在P0端口（与拨码开关对应）
  54   2                      delay_ms(20);
  55   2              }
C51 COMPILER V9.02   TEXT1                                                                 04/12/2020 19:13:32 PAGE 2   

  56   1              //通过串口读取串行数据的代码
  57   1              //      SCON = 0x10;            //设为串口模式0,允许串口接收
  58   1              //      while(1)
  59   1              //      { 
  60   1              //              SPL = 0;                //置数(Load)，读入并行输入口的8位数据
  61   1              //              SPL = 1;                //移位(Shift)，并口输入被封锁，串行转换开始
  62   1              //              while (RI == 0);//等待接收中断标志位被硬件置位
  63   1              //              RI = 0;                 //软件清0接收中断标志位
  64   1              //              P0 = SBUF;              //接收到的字节显示在P0端口(与拨码开关对应)
  65   1              //              delay_ms(20);   //延时
  66   1              //      }
  67   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     75    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
