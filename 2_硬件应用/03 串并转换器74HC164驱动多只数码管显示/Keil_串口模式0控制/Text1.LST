C51 COMPILER V9.02   TEXT1                                                                 04/12/2020 18:31:38 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE TEXT1
OBJECT MODULE PLACED IN Text1.OBJ
COMPILER INVOKED BY: C:\Users\99702\Documents\keil\C51\BIN\C51.EXE Text1.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //-----------------------------------------------------------------
   2          //  名称: 串口模式0控制74HC164驱动多只数码管显示
   3          //-----------------------------------------------------------------
   4          //  说明: 本例运行时,5只独立数码管在串入并出转换器74HC164的驱动下
   5          //        独立显示5位数字，数码管的显示仅占用单片机2只引脚.
   6          //
   7          //-----------------------------------------------------------------
   8          #include <reg51.h>
   9          #include <intrins.h>
  10          #define INT8U  unsigned char
  11          #define INT16U unsigned int
  12          //数码管段码表
  13          const INT8U SEG_CODE[] = 
  14          { 0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90,0xFF };
  15          //数位分解所用的权值表
  16          const INT16U m[] = {10000,1000,100,10};
  17          INT16U val = 42950;             //所演示的起始值
  18          INT8U Buf[5];                           //分解以后的存放缓冲
  19          //-----------------------------------------------------------------
  20          // 延时
  21          //-----------------------------------------------------------------
  22          void delay_ms(INT16U x)
  23          {
  24   1              INT8U i; while(--x) for(i = 0;i < 120; i++) ;
  25   1      }
  26          
  27          //-----------------------------------------------------------------
  28          // 将整数x分解为5个数位,存入数组d
  29          //-----------------------------------------------------------------
  30          void Decompose(INT16U x,INT8U d[])
  31          {
  32   1          INT8U i;
  33   1          for (i = 0; i < 4; i++)
  34   1          {
  35   2              d[i] = 0;
  36   2              while(x >= m[i])
  37   2              {
  38   3                  x -= m[i];
  39   3                  d[i]++;
  40   3              }
  41   2          }
  42   1          d[4] = x;
  43   1      }
  44          
  45          //-----------------------------------------------------------------
  46          // 8位字节逆转函数(例如10101101-->10110101)
  47          // 不使用此函数时,需要修改电路,将数码管引脚与74HC164输出引脚逆向连接
  48          //-----------------------------------------------------------------
  49          INT8U invert(INT8U d)
  50          {
  51   1          INT8U i, dat = 0x00;
  52   1          for(i=0; i<8; i++)
  53   1          {
  54   2              d <<= 1;
  55   2              if (CY)
C51 COMPILER V9.02   TEXT1                                                                 04/12/2020 18:31:38 PAGE 2   

  56   2                  dat |= 1 << i;
  57   2          }
  58   1          return dat;
  59   1      }
  60          
  61          //-----------------------------------------------------------------
  62          // 主程序
  63          //-----------------------------------------------------------------
  64          void main()
  65          {
  66   1          INT8U i;
  67   1          SCON = 0x00;                  //串口模式0，即移位寄存器输入/输出方式
  68   1          TI = 1;                                   //TI置1
  69   1          while(1)
  70   1          {
  71   2              Decompose(val, Buf);                   //分解待显示数据val
  72   2              for(i=4; i!=0xFF; i--)                 //通过串口串行输出各字段码
  73   2              {
  74   3                  SBUF = invert(SEG_CODE[Buf[i]]);   //将段码逆转后通过串口输出
  75   3                  while(TI == 0);                    //等待发送结束
  76   3                  TI = 0;
  77   3              }
  78   2              delay_ms(500);
  79   2              ++val;
  80   2          }
  81   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    208    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     26       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
