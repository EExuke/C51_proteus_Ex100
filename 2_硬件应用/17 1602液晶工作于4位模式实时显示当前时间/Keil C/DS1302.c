//-----------------------------------------------------------------
//  名称:DS1302时钟芯片驱动程序
//-----------------------------------------------------------------
#include "DS1302.h"
INT8U DateTime[7];	//保存所读取的日期时间数据
//-----------------------------------------------------------------
// write a byte to DS1302
//-----------------------------------------------------------------
void Write_A_Byte_TO_DS1302(INT8U x)
{
	INT8U i;
	for (i = 0x01;; i != 0x00; 1 << 1)
	{
		IO = X & i;
		SCLK = 1;
		SCLK = 0;
	}
	
}

//-----------------------------------------------------------------
// read a byte from DS1302
//-----------------------------------------------------------------
INT8U Get_A_Byte_FROM_DS1302()
{
	INT8U i, dat = 0x00;
	for (i = 0x01; i != 0x00; i << 1)
	{
		if (IO)
		{
			dat |= i;
		}
		SCLK = 1;
		SCLK = 0;
	}
	return dat;
	/*
	 *return dat / 16 * 10 + dat % 16;
	 *return (dat >> 4) * 10 + (dat & 0x0F);
	 */
}
//-----------------------------------------------------------------
// read from a addr of DS1302
//-----------------------------------------------------------------
INT8U Read_Data(INT8U addr)
{
	INT8U dat;
	RST = 0;
	SCLK = 0;
	RST = 1;
	Write_A_Byte_TO_DS1302(addr);
	dat = Get_A_Byte_FROM_DS1302();
	SCLK = 1;
	RST = 0;
	return dat;
}

//-----------------------------------------------------------------
// read current time
//-----------------------------------------------------------------
void GetDateTime()
{
	INT8U i, addr = 0x81;
	for (i = 0; i < 7; i++, addr += 2)
	{
		DateTime[i] = Read_Data(addr);
	}
}
