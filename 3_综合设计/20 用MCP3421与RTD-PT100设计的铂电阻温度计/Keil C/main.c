//-----------------------------------------------------------------
//  名称: 用MCP3421与RTD-PT100设计的铂电阻温度计
//-----------------------------------------------------------------
//  说明: 本例MCP3421工作于18位精度模式,程序运行时,根据模/数转换结果
//		  得到阻值,然后根据Callendar-Van Dusen温度/电阻关系式求解方程,
//		  得出-200℃ ~ 850℃范围内的温度值,显示在128*64液晶屏上.
// 
//-----------------------------------------------------------------
#include <reg51.h>
#include <intrins.h>
#include <stdio.h>
#include <string.h>
#include <math.h>
#define INT8U	unsigned char
#define INT16U  unsigned int
#define INT32U  unsigned long
long AD_Result;				//模数转换结果
//ITS-90/IEC751(α = 0.0038505),PT100标准系数
#define coeffA ( 3.9083/1000.0)
#define coeffB (-5.775/10000000.0)
#define coeffC (-4.183/1000000000000.0)
#define R0 100.0  			//PT100在0℃的阻值
#define Gain 4				//增益配置
INT8U d[4];					//MCP3421 A/D转换器结果字节暂存数组
float Res,Temp;				//PT100电阻值,当前温度
char disp_Buff[10];			//显示缓冲
//函数声明
extern void IIC_Init();
extern void Write_MCP3421(INT8U d);
extern void Read_MCP3421(INT8U *d);
extern void Display_A_Char_8x16(INT8U P,INT8U L,INT8U *M);
extern void LCD_Initialize();
extern void Display_A_WORD_String(INT8U P,INT8U L,INT8U C,INT8U *M);
//待显示汉字点阵(在ZIMO软件中取模时,设宋体小四号,纵向取模,字节倒序)
code INT8U DIGIT_Dot_Matrix[] = //0~9,.,-及空格的点阵(8*16)
{
0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00,//0
0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,//1
0x00,0x70,0x08,0x08,0x08,0x88,0x70,0x00,0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00,//2
0x00,0x30,0x08,0x88,0x88,0x48,0x30,0x00,0x00,0x18,0x20,0x20,0x20,0x11,0x0E,0x00,//3
0x00,0x00,0xC0,0x20,0x10,0xF8,0x00,0x00,0x00,0x07,0x04,0x24,0x24,0x3F,0x24,0x00,//4
0x00,0xF8,0x08,0x88,0x88,0x08,0x08,0x00,0x00,0x19,0x21,0x20,0x20,0x11,0x0E,0x00,//5
0x00,0xE0,0x10,0x88,0x88,0x18,0x00,0x00,0x00,0x0F,0x11,0x20,0x20,0x11,0x0E,0x00,//6
0x00,0x38,0x08,0x08,0xC8,0x38,0x08,0x00,0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00,//7
0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00,//8
0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x00,0x31,0x22,0x22,0x11,0x0F,0x00,//9
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,0x00,0x00,//.
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,//-
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,//SP
};
code INT8U WORD_Dot_Matrix[] = //铂电阻温度计,实心右三角形符号,℃的点阵(16*16)
{
/*--  文字:  铂  --*/
0x40,0x30,0x2C,0xEB,0x28,0x28,0x08,0x00,0xF8,0x88,0x8C,0x8B,0x88,0x88,0xF8,0x00,
0x01,0x01,0x01,0x7F,0x21,0x11,0x09,0x00,0x7F,0x20,0x20,0x20,0x20,0x20,0x7F,0x00,
/*--  文字:  电  --*/
0x00,0x00,0xF8,0x48,0x48,0x48,0x48,0xFF,0x48,0x48,0x48,0x48,0xF8,0x00,0x00,0x00,
0x00,0x00,0x0F,0x04,0x04,0x04,0x04,0x3F,0x44,0x44,0x44,0x44,0x4F,0x40,0x70,0x00,
/*--  文字:  阻  --*/
0x00,0xFF,0x11,0x29,0xC7,0x01,0xFE,0x22,0x22,0x22,0x22,0x22,0xFE,0x00,0x00,0x00,
0x00,0xFF,0x02,0x04,0x43,0x40,0x7F,0x42,0x42,0x42,0x42,0x42,0x7F,0x40,0x40,0x00,
/*--  文字:  温  --*/
0x10,0x21,0x86,0x70,0x00,0x7E,0x4A,0x4A,0x4A,0x4A,0x4A,0x7E,0x00,0x00,0x00,0x00,
0x02,0xFE,0x01,0x40,0x7F,0x41,0x41,0x7F,0x41,0x41,0x7F,0x41,0x41,0x7F,0x40,0x00,
/*--  文字:  度  --*/
0x00,0x00,0xFC,0x04,0x24,0x24,0xFC,0xA5,0xA6,0xA4,0xFC,0x24,0x24,0x24,0x04,0x00,
0x80,0x60,0x1F,0x80,0x80,0x42,0x46,0x2A,0x12,0x12,0x2A,0x26,0x42,0xC0,0x40,0x00,
/*--  文字:  计  --*/
0x20,0x21,0x2E,0xE4,0x00,0x00,0x20,0x20,0x20,0x20,0xFF,0x20,0x20,0x20,0x20,0x00,
0x00,0x00,0x00,0x7F,0x20,0x10,0x08,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,
/*--  文字:  右三角形符号  --*/
0x00,0xFE,0xFE,0xFC,0xFC,0xF8,0xF8,0xF0,0xF0,0xF0,0xE0,0xE0,0xC0,0xC0,0x80,0x80,
0x00,0x3F,0x3F,0x1F,0x1F,0x0F,0x0F,0x07,0x07,0x07,0x03,0x03,0x01,0x01,0x00,0x00,
/*--  文字:  ℃  --*/
0x00,0x02,0x05,0xE2,0x18,0x04,0x02,0x02,0x02,0x02,0x02,0x02,0x04,0x1E,0x00,0x00,
0x00,0x00,0x00,0x07,0x18,0x20,0x40,0x40,0x40,0x40,0x40,0x40,0x20,0x18,0x00,0x00
};
//-----------------------------------------------------------------
// 延时函数
//-----------------------------------------------------------------
void delay_ms(INT16U x) {INT8U t; while(x--) for(t = 0; t<120; t++);}
//-----------------------------------------------------------------
// 根据从MCP3421所读取的三字节模数转换结果计算得到电阻值
// 模数转换精度:18位 增益:4 恒流源:1mA
//-----------------------------------------------------------------
void GetRes()
{


}

//-----------------------------------------------------------------
// 正温度直接使用解析法求根
//-----------------------------------------------------------------
void Calc_2_equation(float r)
{


}

//-----------------------------------------------------------------
// 用二分迭代法求解Callendar-Van Dusen方程,根据阻值求取温度值
//-----------------------------------------------------------------
//void Calc_Temp_Bisection()
//{
//} 
//-----------------------------------------------------------------
// 用牛顿法求解Callendar-Van Dusen方程,根据阻值求取温度值
//-----------------------------------------------------------------
void Calc_Temp_Newton()
{


} 

//-----------------------------------------------------------------
// 显示温度
//-----------------------------------------------------------------
void disp_value()
{


}

//-----------------------------------------------------------------
// 主程序
//-----------------------------------------------------------------
void main()
{


}